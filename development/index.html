<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://griadooss.github.io/budget-docs/development/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Development Updates - Budget Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Budget Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../introduction.md" class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../quickstart/" class="nav-link">Quickstart</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Guides</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">User Manual</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../guides/user-manual/basic-overview/" class="dropdown-item">Basic Overview</a>
</li>
            
<li>
    <a href="../guides/user-manual/menu-reference/" class="dropdown-item">Menu Reference</a>
</li>
            
<li>
    <a href="../guides/user-manual/basic-operations/" class="dropdown-item">Basic Operations</a>
</li>
            
<li>
    <a href="../guides/user-manual/getting-started/" class="dropdown-item">Getting Started</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Daily Tasks</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../guides/daily-tasks/categorizing/" class="dropdown-item">Categorizing</a>
</li>
            
<li>
    <a href="../guides/daily-tasks/reconciling/" class="dropdown-item">Reconciling</a>
</li>
            
<li>
    <a href="../guides/daily-tasks/importing/" class="dropdown-item">Importing</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Monthly Tasks</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../guides/monthly-tasks/end-of-month/" class="dropdown-item">End of Month</a>
</li>
            
<li>
    <a href="../guides/monthly-tasks/reporting/" class="dropdown-item">Reporting</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Yearly Tasks</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">End of Year</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../guides/yearly-tasks/end-of-year/overview/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../guides/yearly-tasks/end-of-year/setup/" class="dropdown-item">Setup</a>
</li>
            
<li>
    <a href="../guides/yearly-tasks/end-of-year/developer-guide/" class="dropdown-item">Developer Guide</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">System</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../guides/system/version/" class="dropdown-item">Version</a>
</li>
            
<li>
    <a href="../guides/system/changelog/" class="dropdown-item">Changelog</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Troubleshooting</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../guides/troubleshooting/common-issues/" class="dropdown-item">Common Issues</a>
</li>
            
<li>
    <a href="../guides/troubleshooting/using-ai-help/" class="dropdown-item">Using AI Help</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/griadooss/budget-docs/edit/master/docs/development.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#development-updates" class="nav-link">Development Updates</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#2024-balance-checking-enhancement" class="nav-link">2024 Balance Checking Enhancement</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="development-updates">Development Updates</h1>
<p>This page tracks recent improvements and changes to the budget system.</p>
<h2 id="2024-balance-checking-enhancement">2024 Balance Checking Enhancement</h2>
<p><strong>Date:</strong> December 2024
<strong>Branch:</strong> <code>fix/incidentals</code>
<strong>Issue:</strong> EOY process allowing users to proceed with unbalanced system</p>
<h3 id="problem-identified">Problem Identified</h3>
<p>The End of Year (EOY) process had a critical flaw where users could bypass balance checking with a "proceed anyway" option. This was dangerous because:</p>
<ol>
<li><strong>End of Month Issues</strong> (Low Risk): Unbalanced transactions can be fixed in subsequent months</li>
<li><strong>End of Year Issues</strong> (HIGH RISK): Wrong bank balances get copied to opening positions for new fiscal year, corrupting the entire year's foundation</li>
</ol>
<h3 id="changes-made">Changes Made</h3>
<h4 id="1-refactored-balance-checking-system">1. Refactored Balance Checking System</h4>
<ul>
<li><strong>Before:</strong> Mixed approach with hardcoded cell references and inconsistent checking</li>
<li><strong>After:</strong> Unified <code>checkAllBalances()</code> function using named ranges exclusively</li>
<li><strong>Benefits:</strong></li>
<li>Robust against sheet structure changes</li>
<li>Consistent behavior across all processes</li>
<li>Proper fallback handling</li>
</ul>
<h4 id="2-strict-eoy-balance-enforcement">2. Strict EOY Balance Enforcement</h4>
<ul>
<li><strong>Before:</strong> EOY processes allowed "proceed anyway" option</li>
<li><strong>After:</strong> EOY processes completely blocked if system unbalanced</li>
<li><strong>New Error Message:</strong>
  ```
  üö® Balance Check Failed - EOY Process Blocked</li>
</ul>
<p>Critical balance issues found:
  ‚Ä¢ Banks sheet is not balanced (X.XX)</p>
<p>üî¥ CRITICAL: The End of Year process copies current bank
  balances to become opening balances for the new fiscal year.</p>
<pre><code>‚ùå EOY process cannot proceed until all balances are zero.
</code></pre>
<p>üí° Tip:
  1. First - Update bank balances to June 30 (including final interest)
  2. Second - Use 'Reconciliation Dashboard' to fix Cash Flow issues
  ```</p>
<h4 id="3-developer-mode-support">3. Developer Mode Support</h4>
<ul>
<li><strong>Added:</strong> <code>DEV_MODE</code> bypass for all balance checks</li>
<li><strong>Purpose:</strong> Allows testing of process logic without perfect balance setup</li>
<li><strong>Safety:</strong> Only available when <code>DEV_MODE = true</code> in script properties</li>
</ul>
<h4 id="4-process-specific-behavior">4. Process-Specific Behavior</h4>
<ul>
<li><strong>End of Month:</strong> Retains flexible warning with "proceed anyway" option</li>
<li><strong>End of Year:</strong> Strict blocking with no override option</li>
<li><strong>Reasoning:</strong> Different risk profiles require different approaches</li>
</ul>
<h3 id="files-modified">Files Modified</h3>
<pre><code>src/config/namedRanges.js
‚îú‚îÄ‚îÄ Extended BALANCE_CHECK ranges
‚îî‚îÄ‚îÄ Added MAINTAIN_BUDGET_BALANCE named range

src/utility/endOfMonth.js
‚îú‚îÄ‚îÄ Enhanced checkAllBalances() function
‚îú‚îÄ‚îÄ Added DEV_MODE bypass support
‚îî‚îÄ‚îÄ Consistent error messaging

src/utility/yearEndBudget.js
‚îú‚îÄ‚îÄ Added checkAllBalances() function
‚îú‚îÄ‚îÄ Strict balance checking in showYearEndHelp()
‚îú‚îÄ‚îÄ Removed duplicate balance check in setupNewYearBudget()
‚îú‚îÄ‚îÄ Enhanced continueEOYSetup() balance checking
‚îî‚îÄ‚îÄ DEV_MODE bypass support
</code></pre>
<h3 id="documentation-updated">Documentation Updated</h3>
<pre><code>guides/yearly-tasks/end-of-year/overview.mdx
‚îú‚îÄ‚îÄ Updated Pre-EOY Requirements section
‚îî‚îÄ‚îÄ Added strict balance checking warnings

guides/yearly-tasks/end-of-year/setup.mdx
‚îú‚îÄ‚îÄ Updated balance requirements section
‚îî‚îÄ‚îÄ Removed references to &quot;proceed anyway&quot; option

guides/troubleshooting/common-issues.mdx
‚îú‚îÄ‚îÄ Created comprehensive troubleshooting guide
‚îú‚îÄ‚îÄ Added EOY balance checking failure solutions
‚îú‚îÄ‚îÄ Added developer mode documentation
‚îî‚îÄ‚îÄ Added authorization failure solutions

quickstart.mdx
‚îú‚îÄ‚îÄ Added Critical Balance Requirement section
‚îî‚îÄ‚îÄ Highlighted new strict balance checking
</code></pre>
<h3 id="impact">Impact</h3>
<h4 id="positive">Positive</h4>
<ul>
<li><strong>üõ°Ô∏è Data Protection:</strong> Prevents catastrophic opening balance corruption</li>
<li><strong>üîß Developer Friendly:</strong> DEV_MODE bypass supports testing workflows</li>
<li><strong>üìö Better Documentation:</strong> Comprehensive troubleshooting guidance</li>
<li><strong>üèóÔ∏è Robust Architecture:</strong> Named ranges prevent sheet structure brittleness</li>
</ul>
<h4 id="user-experience">User Experience</h4>
<ul>
<li><strong>‚ö†Ô∏è Stricter Requirements:</strong> Users must resolve balance issues before EOY</li>
<li><strong>üí° Clear Guidance:</strong> Error messages explain why and how to fix issues</li>
<li><strong>üéØ Focused Solutions:</strong> Direct users to Reconciliation Dashboard</li>
</ul>
<h3 id="technical-improvements">Technical Improvements</h3>
<ol>
<li><strong>Named Ranges Exclusively:</strong>
   ```javascript
   // Before: Hardcoded and brittle
   const banksBalance = banksSheet.getRange("C30").getValue();</li>
</ol>
<p>// After: Robust and maintainable
   const banksBalanceRange = ss.getRangeByName("banksBalance");
   const banksBalance = banksBalanceRange.getValue();
   ```</p>
<ol>
<li>
<p><strong>Unified Balance Checking:</strong>
   <code>javascript
   // New comprehensive function
   function checkAllBalances(showDetails = false) {
     // Checks all 3 critical balance cells
     // Returns detailed status information
     // Supports developer mode bypass
   }</code></p>
</li>
<li>
<p><strong>Risk-Based Processing:</strong>
   ```javascript
   // End of Month: Flexible (can be corrected later)
   if (!balanceCheck.isBalanced) {
     const response = ui.alert("‚ö†Ô∏è Balance Check Failed", message, YES_NO);
     if (response !== ui.Button.YES) return;
   }</p>
</li>
</ol>
<p>// End of Year: Strict (prevents data corruption)
   if (!balanceCheck.isBalanced) {
     ui.alert("üö® Balance Check Failed - EOY Process Blocked", message, OK);
     return; // No override option
   }
   ```</p>
<h3 id="future-considerations">Future Considerations</h3>
<ol>
<li><strong>Named Range Management:</strong> Consider creating automated named range validation</li>
<li><strong>Balance Monitoring:</strong> Potential for proactive balance issue detection</li>
<li><strong>Recovery Tools:</strong> Enhanced tools for fixing common balance issues</li>
<li><strong>Audit Trail:</strong> Consider logging balance check results for debugging</li>
</ol>
<h3 id="testing">Testing</h3>
<ul>
<li>‚úÖ <strong>EOY Process:</strong> Blocked when system unbalanced</li>
<li>‚úÖ <strong>EOM Process:</strong> Flexible warning with override option</li>
<li>‚úÖ <strong>DEV_MODE:</strong> All balance checks bypassed appropriately</li>
<li>‚úÖ <strong>Named Ranges:</strong> Robust handling when ranges missing</li>
<li>‚úÖ <strong>Error Messages:</strong> Clear, actionable guidance provided</li>
</ul>
<hr />
<p><em>This update significantly improves the safety and reliability of the budget system while maintaining developer-friendly testing capabilities.</em></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
